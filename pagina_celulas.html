<div class="row">
    <div class="col-12">
        <div class="alert alert-primary" role="alert" style="margin-top: 10px;">
            <div class="row">
                <div class="col-12">
                    <p class="text-center" style="font-size: 30px;">CÃ©lulas</p>
                </div>
            </div>
            <div class="row d-flex justify-content-center">
                <div class="col-12 col-sm-6">
                    <div id="dCelulas">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    $(function(){
        
        const firebaseConfig = {
            apiKey: "AIzaSyC_Lz-HIXHPz90MM_8vERto3dUK1rGts44",
            authDomain: "igreja-batista-campos-brancos.firebaseapp.com",
            databaseURL: "https://igreja-batista-campos-brancos-default-rtdb.firebaseio.com",
            projectId: "igreja-batista-campos-brancos",
            storageBucket: "igreja-batista-campos-brancos.appspot.com",
            messagingSenderId: "724470922283",
            appId: "1:724470922283:web:fcf1eaf1f43df1d48dfe6e",
            measurementId: "G-WKZFS0PDDY"
        };

        if(!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();
        const db = firebase.firestore();

        db.collection("celulas").orderBy("data_celula", "desc").get().then((dataCelulas) => {
            $("#dCelulas").html("");

            dataCelulas.docs.map((val) => {

                let id = val.data().id;

                db.collection("celulas_fotos").where("id_celula", "==", id).get().then((data) => {

                    let dataCelula = val.data().data_celula;
                    let dataFormatada = dataCelula.split("-")[2] + "/" + dataCelula.split("-")[1] + "/" +dataCelula.split("-")[0];

                    var fotos = [];
                    var videos = [];

                    for(var i in data.docs){
                        if(data.docs[i].data().tipo_arquivo == 'imagem'){
                            fotos.push(data.docs[i].data());
                        }else if(data.docs[i].data().tipo_arquivo == 'video'){
                            videos.push(data.docs[i].data());
                        }
                    }

                    let celula = "";
                    celula += "<div class='alert alert-success' style='margin-top: 10px;'>";
                    celula += "<h5>" + val.data().descricao + "</h5><br/>";
                    celula += "<span>" + dataFormatada + "</span><br/><br/>";

                    if(videos.length > 0){
                        celula += "<div id='carouselVideosCelula" + id + "' class='carousel slide' data-ride='carousel'>";
                        /*celula += "<ol class='carousel-indicators'>";

                        for(var i in videos){
                            celula += "<li data-target='#carouselVideosCelula" + id + "' data-slide-to='";
                            celula += i + "'";
                            if(i == 0) celula += " class='active'";
                            celula += "></li>";
                        }

                        celula += "</ol>";*/
                        
                        celula += "<div class='carousel-inner'>";
                        
                        for(var i in videos){
                            celula += "<div class='carousel-item";
                            if(i == 0) celula += " active";
                            celula += "'>";

                            celula += "<video controls name='media' style='width: 100%; height: auto;'>";
                            celula += "<source src='" + videos[i].url_foto  + "'>";
                            celula += "</video>";

                            celula += "</div>";
                        }

                        celula += "</div>"; //Close div carousel-inner

                        celula += "<button class='carousel-control-prev' type='button' data-target='#carouselVideosCelula" + id + "' data-slide='prev'>";
                        celula += "<span class='carousel-control-prev-icon' aria-hidden='true'></span>";
                        celula += "<span class='sr-only'>Previous</span>";
                        celula += "</button>";
                        celula += "<button class='carousel-control-next' type='button' data-target='#carouselVideosCelula" + id + "' data-slide='next'>";
                        celula += "<span class='carousel-control-next-icon' aria-hidden='true'></span>";
                        celula += "<span class='sr-only'>Next</span>";
                        celula += "</button>";

                        celula += "</div>"; //Close div carousel slide
                        celula += "<br/>";
                    }

                    if(fotos.length > 0){
                        celula += "<div id='carouselFotosCelula" + id + "' class='carousel slide' data-ride='carousel'>";
                        celula += "<ol class='carousel-indicators'>";

                        for(var i in fotos){
                            celula += "<li data-target='#carouselFotosCelula" + id + "' data-slide-to='";
                            celula += i + "'";
                            if(i == 0) celula += " class='active'";
                            celula += "></li>";
                        }

                        celula += "</ol>";
                        
                        celula += "<div class='carousel-inner'>";
                        
                        for(var i in fotos){
                            celula += "<div class='carousel-item";
                            if(i == 0) celula += " active";
                            celula += "'>";

                            celula += "<img style='width: auto' src='" + fotos[i].url_foto + "' class='d-block w-100' alt='...'>";

                            celula += "</div>";
                        }

                        celula += "</div>"; //Close div carousel-inner

                        celula += "<button class='carousel-control-prev' type='button' data-target='#carouselFotosCelula" + id + "' data-slide='prev'>";
                        celula += "<span class='carousel-control-prev-icon' aria-hidden='true'></span>";
                        celula += "<span class='sr-only'>Previous</span>";
                        celula += "</button>";
                        celula += "<button class='carousel-control-next' type='button' data-target='#carouselFotosCelula" + id + "' data-slide='next'>";
                        celula += "<span class='carousel-control-next-icon' aria-hidden='true'></span>";
                        celula += "<span class='sr-only'>Next</span>";
                        celula += "</button>";

                        celula += "</div>"; //Close div carousel slide
                    }

                    celula += "</div>"; //Close div alert

                    $("#dCelulas").append(celula);
                });
            });
        });
    });

</script>